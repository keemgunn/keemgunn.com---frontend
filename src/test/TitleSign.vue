<template>
<div class="title-sign-wrapper">
  <svg id="my-sign" viewBox="0 0 395 98" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Group</title>
    <g id="wrapper" stroke="none"  fill="none" fill-rule="evenodd">
      <g id="sign-group" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" stroke="#FEFEFE">
        <g id="sign">
          <path d="M0,111.772923 C1.04817903,111.302795 7.69639672,108.294305 8.86645704,107.771941 C9.75700294,107.373638 16.9382481,104.115393 18.158686,103.570176 C19.1272359,103.137593 28.3853382,99.0125499 29.2320068,98.6371008 C30.0494239,98.2730784 39.3107763,94.1659916 40.2890768,93.7334089 C41.2901284,93.2910319 50.5043533,89.2263871 51.3071447,88.8737914 C52.1066859,88.5228281 60.1833522,84.9805474 61.0056446,84.6214221 C61.8896902,84.2345463 70.7821486,80.3576261 71.6873202,79.9658531 C72.5242384,79.6018307 81.0965553,75.8930464 81.9968517,75.5045382 C82.7752668,75.1698988 90.9868151,71.6439419 91.8724857,71.265228 C92.6557761,70.9305885 100.579685,67.5597085 101.36785,67.225069 C102.274647,66.841458 113.243962,62.2593464 114.087381,61.9083831 C114.969801,61.5394635 124.372536,57.6217336 125.228955,57.2691379 C126.113001,56.9051155 135.278473,53.1522568 136.243773,52.7604838 C137.077441,52.424212 147.386972,48.2910069 148.264518,47.941676 C149.257444,47.5466383 159.490596,43.5228032 160.620029,43.0853234 C161.5122,42.7392572 170.422535,39.3357294 171.347207,38.9863985 C172.328758,38.6174789 181.518607,35.2090539 182.384776,34.8923707 C183.369577,34.5332455 193.433721,30.9370959 194.337267,30.6220451 C195.232689,30.3086268 205.454465,26.7989937 206.544897,26.4349713 C207.558949,26.0970671 217.592216,22.8796315 218.814279,22.4976528 C219.794205,22.1923963 231.476932,18.5178922 232.705495,18.1669289 C233.683796,17.8861582 243.474925,15.2449553 244.454851,14.9854057 C245.540407,14.6981055 254.618125,12.4258222 255.48917,12.2136118 C256.381341,11.9965043 265.327427,9.84501764 266.217973,9.64749875 C267.2369,9.42386167 274.9918,7.85840211 276.026978,7.69842813 C277.067032,7.53682178 283.843631,6.47413754 284.813806,6.3631352 C285.785606,6.25376524 293.373122,5.7509899 294.315671,5.74772513 C295.415853,5.74446035 301.883686,5.73956319 302.798608,5.82444734 C303.90854,5.92728775 309.700339,6.65370016 310.560008,6.98017766 C311.526933,7.34583244 315.318254,8.78070102 315.976413,9.33897753 C316.738577,9.98866773 318.516418,11.3533436 319.04132,12.1107714 C319.535346,12.8241247 320.273134,15.2188371 320.370639,16.010545 C320.461644,16.7663404 320.516897,18.7203082 320.463269,19.5299724 C320.419392,20.2204723 320.320261,20.9305608 320.170754,21.6553409 C320.035872,22.3115606 319.858738,22.9824719 319.639351,23.6648098 C319.42159,24.3520449 319.159952,25.0523392 318.859311,25.7656925 C318.597673,26.3843673 318.305158,27.0128365 317.981766,27.6494676 C317.6795,28.245289 317.352858,28.8460076 316.99859,29.4532557 C316.691449,29.9837817 316.363182,30.5192047 316.015415,31.059525 C315.63677,31.6488169 315.233749,32.2446383 314.809602,32.8453569 C314.448834,33.3562941 314.070189,33.8688638 313.676919,34.3863306 C313.329151,34.8433991 312.968382,35.3021 312.596238,35.7640656 C312.34435,36.0758516 312.087587,36.3876376 311.824323,36.701056 C311.447304,37.1532274 311.057284,37.6053987 310.657513,38.0608348 C310.20899,38.5685073 309.747466,39.0794445 309.271317,39.5920142 C309.778343,39.1333133 310.299995,38.6762448 310.834647,38.2224411 C311.390426,37.7539459 311.959205,37.2870831 312.544236,36.8218527 C313.165018,36.3272393 313.803676,35.8358907 314.455334,35.3478068 C315.183372,34.8042218 315.929285,34.2655339 316.691449,33.7301109 C317.411361,33.2257031 318.147524,32.7261926 318.896688,32.2283144 C319.600349,31.763084 321.246559,30.7461066 321.974597,30.2874057 C322.81639,29.7568798 324.345594,28.8133598 325.216639,28.2926283 C326.042181,27.8012796 328.104413,26.6977857 329.11359,26.1542007 C329.952133,25.7020294 332.012739,24.5691525 333.091795,24.0386265 C334.000217,23.5913524 336.684855,22.313193 337.607903,21.8757132 C338.560202,21.4268066 342.068757,19.8319641 342.866674,19.4810008 C343.77022,19.0826982 347.65092,17.4372517 348.687724,17.0128309 C349.636773,16.6259551 353.65723,15.0409069 354.715159,14.6377072 C355.704835,14.2622581 359.361274,12.9171708 360.199817,12.6184439 C361.065987,12.3099227 364.722425,11.0464548 365.68285,10.7265069 C366.527893,10.4441038 370.116078,9.28184396 371.061877,8.98638184 C372.009301,8.68928732 375.607236,7.60211727 376.457155,7.35399438 C377.342826,7.09444478 380.987889,6.07257023 381.922312,5.82118256 C382.923363,5.55020625 386.485547,4.63443688 387.268837,4.44181516 C388.10413,4.23776673 391.466429,3.45258837 392.303347,3.26812859 C393.304398,3.04775628 397.188349,2.2642103 398.119522,2.09444201 C399.088072,1.91977655 402.671381,1.35660288 403.487173,1.25213008 C404.746613,1.09215611 407.304495,0.739560419 408.126788,0.775472943 C409.186342,0.821179792 411.354204,0.865254253 412.228499,1.0415521 C414.279355,1.4578109 415.207278,2.00792547 415.818309,2.40459562 C416.661727,2.95307781 417.464519,3.84272897 417.802536,4.54792035 C418.112927,5.19271339 418.696332,6.08726172 418.844215,6.84142472 C418.985597,7.54824849 419.151356,9.02392675 419.159481,9.81563466 C419.167607,10.4718544 419.13023,11.1541924 419.052226,11.8626485 C418.972597,12.5939581 418.84909,13.3513859 418.684957,14.1300347 C418.556575,14.7372828 418.403817,15.3575901 418.226683,15.9909564 C418.018672,16.7353251 417.779785,17.4960176 417.508396,18.2714017 C417.28901,18.8998708 417.051748,19.5381343 416.793359,20.1845598 C416.523595,20.8603682 416.232705,21.5459709 415.920689,22.2397356 C415.603798,22.9481917 415.265781,23.6664422 414.909887,24.3895898 C414.625498,24.967455 414.328107,25.5485849 414.020966,26.1329796 C413.691074,26.7565517 413.348182,27.3833884 412.997164,28.0118576 C412.665647,28.6027819 412.322754,29.1937061 411.971736,29.7862628 C411.610967,30.3918785 411.242073,31.000759 410.863429,31.6063748 C410.364528,32.407877 409.846126,33.2093793 409.316349,34.0092491 C409.972883,33.5848284 410.624541,33.1669372 411.266449,32.7588403 C411.965235,32.3148309 412.655896,31.8822483 413.336806,31.4578275 C414.131472,30.9632141 414.914762,30.4816598 415.689927,30.0115322 C416.517095,29.5087569 417.841538,28.7513291 418.645955,28.2763044 C419.569002,27.731087 420.930823,26.9426438 421.821368,26.4317066 C422.715165,25.9191369 424.135488,25.1160023 424.998407,24.6377127 C425.854826,24.162688 427.418157,23.3122141 428.224198,22.8926906 C429.03024,22.473167 431.467866,21.2880537 432.243031,20.8995455 C433.159578,20.4392122 435.382692,19.3797928 436.269988,18.9700635 C437.121532,18.5782905 439.455152,17.4780614 440.332698,17.1091418 C441.291497,16.7075745 443.210721,15.9207637 444.104517,15.5649033 C445.022689,15.1992485 446.828157,14.4891599 447.676451,14.169212 C448.419114,13.8900737 451.05175,12.7490349 451.696908,12.5237654 C452.493199,12.2462596 454.752066,11.4170068 455.61661,11.1280742 C456.419402,10.8603626 458.818026,10.259644 459.537938,10.1306854 C460.509738,9.95765237 462.217701,9.68177889 462.911612,9.78135453 C463.779406,9.90704836 464.704079,10.4359419 464.897464,11.1770458 C465.064848,11.8136769 465.074598,12.6331354 464.561072,13.8672203 C464.271807,14.5593526 463.863911,15.3559577 463.321133,16.2700947 C462.98474,16.8349007 462.596345,17.4437812 462.152697,18.1016334 C461.827681,18.5831877 461.473412,19.0908602 461.086642,19.6230185 C460.803878,20.0147915 460.504862,20.4196236 460.187971,20.8391471 C459.851579,21.2847889 459.495685,21.7483869 459.120291,22.2266765 C458.736771,22.7131279 458.335376,23.2175357 457.909604,23.741532 C457.560211,24.1741147 457.192942,24.6197565 456.811047,25.0800897 C456.440528,25.5240991 456.057008,25.9811676 455.657238,26.4512952 C455.369598,26.7891994 455.073833,27.1336332 454.771567,27.4845965 C454.44005,27.8698399 454.098782,28.2616129 453.747764,28.6615478 C453.248863,29.231251 452.732087,29.8172781 452.194184,30.4196291" id="keem"></path>
          <path d="M205,155.772923 C206.100355,155.202656 210.521281,152.924814 211.633014,152.356158 C212.554582,151.882548 216.756087,149.738411 217.929582,149.14237 C218.955172,148.622043 223.111167,146.51979 224.164388,145.991408 C225.014441,145.562903 229.007902,143.56375 230.150516,142.993483 C231.26875,142.437716 235.993615,140.098658 237.235375,139.488119 C238.54865,138.842139 243.557949,136.39515 244.754199,135.813607 C245.916317,135.251395 250.568041,133.010604 251.728534,132.454836 C252.832141,131.926454 257.166923,129.866085 258.231521,129.363478 C259.387138,128.818986 263.95922,126.676461 265.090457,126.14969 C266.327341,125.576202 271.318761,123.274195 272.57515,122.702318 C273.974568,122.061171 279.601496,119.519137 281.015542,118.887656 C282.418211,118.261008 287.752578,115.90423 289.020343,115.350073 C290.574168,114.670264 296.392887,112.16206 297.753297,111.583739 C298.960924,111.069855 303.833695,109.022374 305.060827,108.513323 C306.48625,107.922115 312.337475,105.533118 313.831163,104.933855 C315.165568,104.39903 320.699851,102.21462 322.125275,101.662074 C323.830257,101.001596 330.047184,98.6496513 331.459604,98.1261018 C333.177589,97.4897879 339.448152,95.2296652 340.875201,94.7302796 C342.461533,94.1729008 348.688212,92.0545392 350.214406,91.5519317 C351.764981,91.0412697 357.651964,89.17099 359.046506,88.7440958 C360.725482,88.2302119 366.7815,86.4581984 368.145161,86.078021 C369.581962,85.6769015 375.340543,84.1529699 376.777343,83.7953454 C378.204392,83.4393318 384.076747,82.0748814 385.565559,81.755919 C386.912966,81.469175 392.421244,80.3946904 393.81091,80.1530522 C395.241209,79.9049703 400.096101,79.1639465 401.121691,79.0286291 C402.230173,78.8836462 406.763247,78.3907042 407.883107,78.3166019 C409.292277,78.2231684 414.093532,78.2344449 415.104494,78.3246565 C416.437273,78.4438646 420.364095,79.1413936 421.305167,79.7197144 C422.260867,80.3060897 424.157639,81.6850384 424.679374,82.4743899 C425.379895,83.5311543 425.896753,85.4916456 425.648076,86.569352 C425.412402,87.5858434 425.144221,89.396519 424.724883,90.644983 C424.448575,91.4665529 423.544886,93.5510852 423.130424,94.3871533 C422.67858,95.3005457 422.041446,96.545788 421.500208,97.4833442 C421.08087,98.2082588 420.640403,98.9380062 420.180432,99.6693645 C419.559551,100.65847 418.902914,101.652409 418.226772,102.644736 C419.21823,102.201733 420.635527,101.63791 421.620483,101.206183 C422.857367,100.664914 423.579018,100.316955 424.807775,99.7917945 C425.895128,99.3278491 426.750057,98.9138424 427.829283,98.4611735 C428.851622,98.0342793 430.179525,97.5107299 431.193738,97.0951121 C432.459878,96.5763955 433.956816,95.8869211 435.213204,95.3843137 C436.295681,94.9525867 438.468761,94.1213513 439.744653,93.6380749 C440.784871,93.2433992 444.165579,91.9417747 445.19767,91.5599864 C446.484939,91.0815427 449.720992,89.949065 451.070024,89.4802869 C452.397928,89.0195634 455.724999,87.8886966 457.031773,87.448915 C458.479951,86.9624168 462.58231,85.626963 463.82407,85.2387309 C465.129218,84.8327788 469.446122,83.5069905 470.956063,83.0768745 C472.441624,82.6548131 476.504975,81.4868951 477.954779,81.0970521 C479.372076,80.7136528 485.010381,79.2799328 486.409799,78.9464721 C487.77346,78.621066 493.265485,77.4032095 494.642148,77.1212982 C496.22848,76.7991139 502.479539,75.6618035 504.012235,75.4217762 C505.359642,75.2091346 510.612742,74.5099947 511.883758,74.3730664 C513.401826,74.2119742 518.905228,73.8205203 520.142112,73.7818582 C521.245719,73.7480289 526.14612,73.8140767 527.422012,73.9155647 C528.868565,74.0299401 532.683238,74.9159469 533.716955,75.6746908 C534.997723,76.6170798 536.940005,78.0137486 537.744548,79.2525472 C538.332921,80.1546631 539.626692,82.8094615 540.09479,83.824342 C540.556387,84.8311678 541.625861,86.9962461 542.191479,87.899973 C542.849742,88.9519047 543.967976,90.5741025 544.941555,91.3602321 C545.85012,92.0932013 548.909011,93.3916039 550.496968,93.3883821 C551.74523,93.3867712 556.146651,93.1386893 557.715105,92.8889965 C559.31769,92.6360818 563.719112,91.6598635 565.264811,91.2265256 C567.241224,90.6723687 570.438269,89.7042049 572.396804,89.1484371 C574.527625,88.5427306 578.709626,87.347427 580.871328,86.7368878 C583.293086,86.0506353 586.717678,85.0647514 589.093925,84.4074955 C591.346647,83.784069 595.445755,82.5807107 597.652967,81.9959462 C600.370536,81.2742535 603.574082,80.4800692 606.21201,79.8340898 C608.43385,79.2879874 611.751169,78.4390319 613.909621,77.9605882 C616.300497,77.4305951 619.178975,76.8554962 621.482082,76.4237693 C623.287835,76.0854758 628.206115,75.2912915 629.956606,75.0931482 C632.487261,74.8080151 636.623752,74.3972302 639,74.3086295" id="gunn"></path>
        </g>
      </g>
    </g>
  </svg>


  <canvas id="title-sign"></canvas>
</div>
</template>






<script>
import { mapState, mapGetters, mapMutations } from 'vuex';
const paper = require('paper');

const axios = require('axios');



export default {
  name: "TitleSign",
  components: { },
  data() { return {
    scope: null,
    relocationInfo: {
      x:0.1, y:0, w:0.8, h:0.4
    },
    // _____ RENDERING _____
    renderProgress: {path:0, seg:0},
    renderSpeed: 18,
    RENDERED: [],
    renPath: [],

    signPackage : []
  }},
  computed: {
    ...mapState(['winSize', 'displayConfig', 'renderSign']),
    ...mapGetters(['SEQ', 'RENDER_Q']),
    X: function(){
      return this.displayConfig.x
    },
    Y: function(){
      return this.displayConfig.y
    },
    W: function(){
      return this.displayConfig.width
    },
    H: function(){
      return this.displayConfig.height
    },
  },
  methods: {
    ...mapMutations(['renderTrigger']),
    RELOCATE(){
      this.displayConfig.x = this.getSize('x', 'vw');
      this.displayConfig.y = this.getSize('y', 'vh');
      this.displayConfig.width = this.getSize('w', 'vw');
      this.displayConfig.height = this.getSize('h', 'vw');
      this.canvasStyle = {
        'left': this._px(this.X),
        'top': this._px(this.Y),
        'width': this._px(this.W),
        'height': this._px(this.H)
      };
      if(this.scope.view){
        this.scope.view.viewSize.width = this.W;
        this.scope.view.viewSize.height = this.H;
      }
    },
    getSize(i, el){
      return this['relocationInfo'][i] * this['winSize'][el]
    },
    _px(source){
      return source + 'px'
    },

    render(){
      this.stroke({
        pathIndex: this.renderProgress.path, 
        segIndex: this.renderProgress.seg
      });
    },
    stroke({pathIndex, segIndex}){
      let segPoint = new this.scope.Point(
        this.renderSign.arr[pathIndex][segIndex].x 
          * this.renderSign.scale
        ,this.renderSign.arr[pathIndex][segIndex].y 
          * this.renderSign.scale
      );
      if(segIndex===0){ 
        // FIRST SEG ---
        this.renPath = new this.scope.Path({
          segments: [ segPoint ], // array
          strokeColor: 'red',
          strokeWidth: 7,
          strokeCap: 'round'
        });
        this.renderProgress.seg += 1;
        setTimeout(this.stroke, this.renderSpeed, {
          pathIndex: this.renderProgress.path, 
          segIndex: this.renderProgress.seg
        });
      }
      else if(segIndex === this.renderSign.arr[pathIndex].length-1){ 
        // LAST SEG ---
        this.renPath.add(segPoint);
        this.renPath.simplify(this.simplifyVal);
        this.RENDERED.push(this.renPath);
        if(pathIndex === this.renderSign.arr.length-1){
          // LAST PATH / LAST SEG ---
          console.log('-- RENDER DONE --');
          this.renderProgress.path = 0;
          this.renderProgress.seg = 0;
        }else{
          this.renderProgress.path += 1;
          this.renderProgress.seg = 0;
          setTimeout(this.stroke, this.renderSpeed*20, {
            pathIndex: this.renderProgress.path, 
            segIndex: this.renderProgress.seg
          })
        }
      }
      else{
        this.renPath.add(segPoint);
        this.renPath.smooth('continuous');
        this.renderProgress.seg += 1;
        setTimeout(this.stroke, this.renderSpeed, {
          pathIndex: this.renderProgress.path, 
          segIndex: this.renderProgress.seg
        })
      }
    },

    async sendMySign(){
      console.log('sendMySign');
      let {data} = axios.post('/load/mysign', {signPackage:this.signPackage});
      console.log(data);
    }

  },
  watch: {
    RENDER_Q(nu, old){
      if(nu){
        console.log('-- render go --');
        this.render();
      }
      if(old){
        console.log('-- render done --');
        // == refresh method here ==
        // if(this.RENDERED.length){
        //   for(var i=0; i < this.RENDERED.length; i++){
        //     this.RENDERED[i].remove();
        //   }
        // }
      }
    }
  },
  created() {
    this.scope = new paper.PaperScope();
  },
  mounted() {
    this.RELOCATE();
    this.$nextTick(() => {
      window.addEventListener('resize', this.RELOCATE);
    });
    this.scope.setup(document.getElementById('title-sign'));



    var mySign = this.scope.project.importSVG(document.getElementById('my-sign'));
      mySign.visible = true;
      mySign.fitBounds(this.scope.view.bounds);
      mySign.position = this.scope.view.center;


    var keem = mySign.children[1].children[0].children[0].children[0];
    var gunn = mySign.children[1].children[0].children[0].children[1];
    console.log(keem);
    console.log(gunn);


    let signWidth = this.scope.view.bounds.width;
    let signHeight = gunn.bounds.bottom - keem.bounds.top;
    console.log('signWidth');
    console.log(signWidth);
    console.log('signHeight');
    console.log(signHeight);

    let marginTop = keem.bounds.top;
    console.log('marginTop');
    console.log(marginTop);
    let marginBottom = gunn.bounds.bottom;
    console.log('marginBottom');
    console.log(marginBottom);

    console.log('keem.segments[0].point');
    console.log(keem.segments[0].point);


    let keemSegments = [];
    for(var i=0; i < keem.segments.length; i++){
      keemSegments.push({x:keem.segments[i].point.x,y:keem.segments[i].point.y});
    }
    let gunnSegments = [];
    for(var j=0; j < gunn.segments.length; j++){
      gunnSegments.push({x:gunn.segments[j].point.x,y:gunn.segments[j].point.y});
    }
    this.signPackage.push(keemSegments);
    this.signPackage.push(gunnSegments);
    console.log('signPackage');
    console.log(this.signPackage);

    this.scope.view.onMouseDown = () => {
      this.sendMySign();
    }

  },
  beforeUpdate() {
    
  },
  beforeCreate() {
    
  },
}
</script>



<style lang="scss" scoped> 
.title-sign-wrapper{
  position: relative; 
  background-color: rgba(240, 248, 255, 0.308);
}

#title-sign{
  width: 100%; height: 100%;
}






</style>